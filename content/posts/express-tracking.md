---
title: "Node-Red-快递最新动态查询跟踪"
date: 2023-02-02T22:41:17+08:00
draft: true
---


## 前言

通过 `Node-Red` 实现快递动态查询、自动跟踪最新动态并TTS播报。

----

## 效果展示


<div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">  
    <iframe src="//player.bilibili.com/player.html?bvid=BV17y4y1X7NS"  scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;"></iframe>  
</div>


----


## 功能列表

### v4.0

- [ ] 异常情况通知提醒
- [ ] HA 面板配置化

### v3.3

- [x] 新增单号信息后查询异常的快递单号（如当前状态处于等待快递员上门取件阶段），增加12小时内自动重试查询逻辑

### v3.2

- [x] 优化数字字符串的 TTS 播报：解决 tts 播报数字类似 155 读成一百五十五
- [x] 优化： `已签收` 快递信息留存时间改为 `2` 天内

### v3.1

- [x] 对处于 `派件中` 和 `已签收` 状态下的动态内容做优化，去除一些不重要信息
- [x] 对处于 `派件中` 状态的快递提高检测效率
- [x] 支持手动触发 `立即查询` 最新动态操作

### v3.0

- [x] 定时查询增加 `随机延迟` 机制，防止查询播报冲突，降低接口请求频率
- [x] 当 `单号后4位+备注` 相同时判定为重复单号，自动去重并立即查询最新动态
- [x] 对单号按照 `派送顺序` 排序展示在 HA 面板 : `派送中` -- `在途中` -- `三日内已签收`

### v2.1

- [x] `已签收` 的快递信息超过 3 日自动删除
- [x] 支持 `夜间勿扰模式`，设置仅在每天 7:00~23:00 之间执行查询及播报通知操作
- [x] 支持手动删除某快递信息不再跟踪

### v2.0

- [x] 支持多个快递单号同时查询并跟踪动态
- [x] 在 HA 面板显示最新快递动态

### v1.0

- [x] 支持手动输入快递单号及备注信息
- [x] 输入快递单号后立即查询并播报通知当前最新动态
- [x] 支持快递单号实时动态自动跟踪
- [x] 定时查询，设置每隔 1 小时查询一次最新动态
- [x] 有新动态时通过天猫精灵 TTS 播报
- [x] 有新动态时发送消息通知到手机端

----

## 设备清单

- HomeAssistant
- Node-Red
- 树莓派(可选，或其他支持蓝牙连接设备)
- 天猫精灵音箱(或其他蓝牙音箱)
- Bark(iPhone端接收通知)

----

